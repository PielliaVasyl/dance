{% extends "base.html" %}
{% block title %}{{ title }} - {% endblock %}

{% block wrapper %}
<style>
#my_gmap {
    width: 100%;
    height: 400px;
    display: block;
    /*-webkit-filter: grayscale(100%);
    -moz-filter: grayscale(100%);
    -ms-filter: grayscale(100%);
    -o-filter: grayscale(100%);
    filter: grayscale(100%);*/
    filter: url(data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter i…0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale);
    filter: gray;
    z-index: 1;
    }
</style>
        <!-- WRAPPER -->
		<div id="wrapper">

			<section class="container top-no-header">

				<div style='margin-bottom: 40px;' id="my_gmap"></div>

				<div class="row">

					<!-- center column -->
					<div class="col-md-12">

						<!-- CATEGORY TITLE -->
						<h3 class="page-header nomargin-top">
							<strong class="styleColor">{{ location_title }}</strong> на карте
						</h3>

                        {% for instance in instances %}

						<!-- article summary -->
						<div class="row">
							<div class="col-md-3 text-center">
								{% if instance.image %}
								<img alt="{{ instance.title }}" class="img-responsive" src="{{ instance.image.url }}" />
								{% endif %}
							</div>
							<div class="col-md-9">
								 <div class="row">
									 <div class="col-sm-5">
									 	<h4><a class="styleColor" href="realestate-single.html">{{ instance.title }}</a></h4>
									 </div>
									 <div class="col-sm-5">
										 {% for address in instance.get_locations_address_list %}{{ address }} <br />{% endfor %}
									 </div>
									 <div class="col-sm-2">
									 	<p><small class="block styleSecondColor fsize17">
											{% for link in instance.get_links_list %}
												<a href="{{ link }}">Источник</a>
											{% endfor %}
										</small></p>
									 </div>
								 </div>
								<div class="row">
									<div class="col-sm-6">
										{% for dance_type in instance.get_dance_types_list %}{{ dance_type }}{% if not forloop.last %}, {% endif %}{% endfor %}
									</div>
									<div class="col-sm-6">
										<p>
											<span class="fsize12 pull-right">
												<!--<i class="bed-ico" title="beds"></i> 3 ,
												<i class="garage-ico" title="garage"></i> 1 ,
												<i class="furnished-ico" title="furnished"></i>-->
											</span>
										</p>
									</div>
								</div>
							</div>
						</div>
						<!-- /article summary -->


						{% if not forloop.last %}<hr class="half-margins" /><!-- separator -->{% endif %}

                        {% endfor %}

						<hr /><!-- final separator -->

					</div>
				</div>
			</section>


		</div>
		<!-- /WRAPPER -->
<script>
    var map;
    function initMap() {
        // set map settings
        map = new google.maps.Map(document.getElementById('my_gmap'), {
            center: {lat: 50.448, lng: 30.52},
            zoom: 12
        });

		var infoWin = new google.maps.InfoWindow();
		// Add some markers to the map.
		// Note: The code uses the JavaScript Array.prototype.map() method to
		// create an array of markers based on a given "locations" array.
		// The map() method here has nothing to do with the Google Maps API.
		var markers = locations.map(function(location, i) {
			var marker = new google.maps.Marker({
		        position: location
		    });
		    google.maps.event.addListener(marker, 'click', function(evt) {
		        infoWin.setContent(location.info);
		        infoWin.open(map, marker);
		    })
		    return marker;
		});

		// Add a marker clusterer to manage the markers.
		var markerCluster = new MarkerClusterer(map, markers, {
			imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
		});

        // recenter while resize window
        var currCenter = map.getCenter();
        google.maps.event.addDomListener(window, 'resize', function() {
            map.setCenter(currCenter);
        });
        google.maps.event.addListener(map, 'idle', function(){
            currCenter = map.getCenter();
        });
    }

    var locations = [
	{% for instance in instances %}
	{% for location in instance.locations.all %}

	{
	lat: {{ location.coordinates.lat }},
	lng: {{ location.coordinates.lng }},
	//title: '{{ instance.title }}',
	info: '<div>'+
			'<h3>{{ instance.title }}</h3>'+
			{% if instance.image %}
			'<div class="text-center">'+
				'<img alt="{{ instance.title }}" class="img-responsive" src="{{ instance.image.url }}" style="max-width:200px"/>'+
			'</div>'+
			{% endif %}
			'<div class="popover-content">'+
				'<a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
				'Перейти</a>'+
			'</div>'+
		   '</div>'
	},

	{% endfor %}
	{% endfor %}
	]

</script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSeJVa4nfu8wrpf_C9UuwLTuqVjoTZ2-E&callback=initMap">
</script>
{% endblock %}